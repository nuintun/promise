!function(){"use strict";function t(t){return"function"==typeof t}function r(t){return"function"==typeof t&&c.test(t)}function e(t,r){this.task=t,this.args=r}function n(){var t=d;d=[];for(var r=0,e=t.length;r<e;r++)t[r].run()}function s(){this._callbacks=[],this._errbacks=[],this._status="pending",this._result=null}function i(r){if(!(this instanceof i))throw new TypeError(this+"is not a promise");if(!t(r))throw new TypeError("Promise resolver "+r+" is not a function");var e=new s;this._resolver=e;try{r(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(n){e.reject(n)}}function a(t,r,e,n){return function(s){var i;try{i=n(s)}catch(a){return e(a)}if(i===t)return e(new TypeError("Cannot resolve a promise with itself"));r(i)}}if(!window.Promise){var o=Object.prototype.toString,u=t(Array.isArray)?Array.isArray:function(t){return"[object Array]"===o.call(t)},c=Function.prototype.toString.call(Function);c=(c=c.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),c=new RegExp("^"+c+"$");var l=window.MutationObserver||window.WebKitMutationObserver,f={support:function(){return r(l)},install:function(t){var r=0,e=new l(t),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=r=++r%2}}},h=window.VBArray,p=window.MessageChannel,_={support:function(){return!r(h)&&r(p)},install:function(t){var r=new p;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}},v={support:function(){return!0},install:function(t){var r=new Image;return r.onerror=t,function(){r.src=""}}};e.prototype.run=function(){var t=this.task,r=this.args;switch(r.length){case 0:return t();case 1:return t(r[0]);case 2:return t(r[0],r[1]);case 3:return t(r[0],r[1],r[2]);default:return t.apply(null,r)}};for(var w,d=[],y=Array.prototype.slice,b=[f,_,v],g=0,k=b.length;g<k;g++)if((w=b[g]).support()){w=w.install(n);break}s.prototype={fulfill:function(t){var r=this._status;"pending"!==r&&"accepted"!==r||(this._result=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._result),this._callbacks=[],this._errbacks=null)},reject:function(t){var r=this._status;"pending"!==r&&"accepted"!==r||(this._result=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._result),this._callbacks=null,this._errbacks=[])},resolve:function(t){"pending"===this._status&&(this._status="accepted",this._value=t,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(r){var e,n=this,s=!1;if(!r||"object"!=typeof r&&!t(r))return n.fulfill(r);try{t(e=r.then)?e.call(r,function(t){s||(s=!0,n._unwrap(t))},function(t){s||(s=!0,n.reject(t))}):n.fulfill(r)}catch(i){s||n.reject(i)}},_addCallbacks:function(t,r){var e=this._callbacks,n=this._errbacks;switch(e&&e.push(t),n&&n.push(r),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._result);break;case"rejected":this.reject(this._result)}},_notify:function(t,r){t.length&&function(t){var r=y.call(arguments,1);d.push(new e(t,r)),w()}(function(){for(var e=0,n=t.length;e<n;++e)t[e](r)})}},i.prototype={then:function(r,e){var n,s,o=new i(function(t,r){n=t,s=r});return this._resolver._addCallbacks(t(r)?a(o,n,s,r):n,t(e)?a(o,n,s,e):s),o},"catch":function(t){return this.then(undefined,t)}},i.resolve=function(t){return t&&t.constructor===i?t:new i(function(r){r(t)})},i.reject=function(t){var r=new this(function(){});return r._resolver._result=t,r._resolver._status="rejected",r},i.all=function(t){return new i(function(r,e){function n(t){return function(e){a[t]=e,--c||r(a)}}if(!u(t))return e(new TypeError("Promise.all expects an array of values or promises"));var s=0,a=[],o=t.length,c=t.length;if(o<1)return r(a);for(;s<o;s++)i.resolve(t[s]).then(n(s),e)})},i.race=function(t){return new i(function(r,e){if(!u(t))return e(new TypeError("Promise.race expects an array of values or promises"));for(var n=0,s=t.length;n<s;n++)i.resolve(t[n]).then(r,e)})},window.Promise=i}}();
//# sourceMappingURL=promise.js.map