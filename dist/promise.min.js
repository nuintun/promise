!function(){"use strict";function t(t){return"function"==typeof t&&o.test(t)}function e(t,e){this.task=t,this.args=e}function n(){var t=w;w=[];for(var e=0,n=t.length;e<n;e++)t[e].run()}function r(t){return"function"==typeof t}function i(){}function s(){this._callbacks=[],this._errbacks=[],this._status="pending",this._value=null,this._chained=!1}function a(t){if(!(this instanceof a))throw new TypeError(this+"is not a promise");if(!r(t))throw new TypeError("Promise resolver "+t+" is not a function");var e=new s;this._resolver=e;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(n){e.reject(n)}}function c(t,e,n,r){return function(i){var s;try{s=r(i)}catch(a){return n(a)}if(s===t)return n(new TypeError("Cannot resolve a promise with itself"));e(s)}}if(!window.Promise){var o=Function.prototype.toString.call(Function);o=(o=o.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),o=new RegExp("^"+o+"$");var u=window.MutationObserver||window.WebKitMutationObserver,l={support:function(){return t(u)},install:function(t){var e=0,n=new u(t),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}},f=window.VBArray,h=window.MessageChannel,p={support:function(){return!t(f)&&t(h)},install:function(t){var e=new h;return e.port1.onmessage=t,function(){e.port2.postMessage(0)}}},_={support:function(){return!0},install:function(t){var e=new Image;return e.onerror=t,function(){e.src=""}}};e.prototype.run=function(){var t=this.task,e=this.args;switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);default:return t.apply(null,e)}};for(var v,w=[],d=Array.prototype.slice,y=[l,p,_],g=0,b=y.length;g<b;g++)if((v=y[g]).support()){v=v.install(n);break}var k=Object.prototype.toString,j=r(Array.isArray)?Array.isArray:function(t){return"[object Array]"===k.call(t)},m=window.console,A=m&&m.error?m.error:i;s.prototype={fulfill:function(t){var e=this._status;"pending"!==e&&"accepted"!==e||(this._value=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._value),this._callbacks=[],this._errbacks=null)},reject:function(t){var e=this._status;"pending"!==e&&"accepted"!==e||(this._value=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._value),this._callbacks=null,this._errbacks=[])},resolve:function(t){"pending"===this._status&&(this._status="accepted",this._value=t,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(t){var e=this,n=!1;if(!t||"object"!=typeof t&&!r(t))return e.fulfill(t);try{var i=t.then;r(i)?i.call(t,function(t){n||(n=!0,e._unwrap(t))},function(t){n||(n=!0,e.reject(t))}):e.fulfill(t)}catch(s){n||e.reject(s)}},_addCallbacks:function(t,e){var n=this._callbacks,r=this._errbacks;switch(n&&n.push(t),r&&r.push(e),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._value);break;case"rejected":this.reject(this._value)}},_notify:function(t,n){!function(t){var n=d.call(arguments,1);w.push(new e(t,n)),v()}(function(e){if(!e._chained)return e._uncaught();if(t.length)for(var r=0,i=t.length;r<i;++r)t[r](n)},this)},_uncaught:function(){var t=this._value;A("Uncaught",t.stack||t.name+": "+t.message)}},a.prototype={then:function(t,e){var n,i,s=this._resolver;s._chained=!0;var o=new a(function(t,e){n=t,i=e});return s._addCallbacks(r(t)?c(o,n,i,t):n,r(e)?c(o,n,i,e):i),o},"catch":function(t){return this.then(undefined,t)}},a.resolve=function(t){return t&&t instanceof a?t:new a(function(e){e(t)})},a.reject=function(t){var e=new a(i),n=e._resolver;return n._result=t,n._status="rejected",e},a.all=function(t){return new a(function(e,n){function r(t){return function(n){s[t]=n,--o||e(s)}}if(!j(t))return n(new TypeError("Promise.all expects an array of values or promises"));var i=0,s=[],c=t.length,o=t.length;if(c<1)return e(s);for(;i<c;i++)a.resolve(t[i]).then(r(i),n)})},a.race=function(t){return new a(function(e,n){if(!j(t))return n(new TypeError("Promise.race expects an array of values or promises"));for(var r=0,i=t.length;r<i;r++)a.resolve(t[r]).then(e,n)})},window.Promise=a}}();
//# sourceMappingURL=promise.js.map