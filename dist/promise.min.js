/**
 * @module promise
 * @author nuintun
 * @license MIT
 * @version 1.1.0
 * @description A pure JavaScript ES6 promise polyfill.
 * @see https://nuintun.github.io/promise#readme
 */
!function(){"use strict";function t(t){var n=this.constructor;return"function"!=typeof t?this:this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})}if("function"!=typeof window.Promise){g.prototype.run=function(){var t=this.task,n=this.args;switch(n.length){case 0:return t();case 1:return t(n[0]);case 2:return t(n[0],n[1]);case 3:return t(n[0],n[1],n[2]);default:return t.apply(null,n)}};var n={support:function(){return"onreadystatechange"in document.createElement("script")},install:function(t){return function(){var n=document.createElement("script");n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},document.documentElement.appendChild(n)}}},e=Function.prototype.toString.call(Function);e=(e=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),e=new RegExp("^"+e+"$");for(var r,i=window.VBArray,o=window.MessageChannel,s={support:function(){return!m(i)&&m(o)},install:function(t){var n=new o;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}},a={support:function(){return!0},install:function(t){return function(){setTimeout(t,0)}}},c=window.MutationObserver||window.WebKitMutationObserver,u=[],f=!1,l=[{support:function(){return m(c)},install:function(t){var n=!0,e=new c(t),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=n=!n}}},s,n,a],h=0,p=l.length;h<p;h++)if((r=l[h]).support()){r=r.install(b);break}var d=Object.prototype.toString,v=j(Array.isArray)?Array.isArray:function(t){return"[object Array]"===d.call(t)},w=window.console,y=w&&w.error?w.error:function(){};E.prototype={fulfilled:function(t){"pending"===this.state&&(this.value=t,this.state="fulfilled"),"fulfilled"===this.state&&(this.notify(this.callbacks,this.value),this.callbacks=[],this.errbacks=null)},rejected:function(t){"pending"===this.state&&(this.value=t,this.state="rejected"),"rejected"===this.state&&(this.notify(this.errbacks,this.value),this.callbacks=null,this.errbacks=[])},resolve:function(t){var n=this;if("pending"===n.state){if(!t||"object"!=typeof t&&!j(t))return n.fulfilled(t);var e=!1;try{j(t.then)?t.then(function(t){e||(e=!0,n.resolve(t))},function(t){e||(e=!0,n.reject(t))}):n.fulfilled(t)}catch(r){e||n.rejected(r)}}},reject:function(t){"pending"===this.state&&this.rejected(t)},addCallbacks:function(t,n){var e=!1,r=this.callbacks,i=this.errbacks;if(r&&(e=!0,r.push(t)),i&&(e=!0,i.push(n)),e)switch(this.chained=e,this.state){case"fulfilled":this.fulfilled(this.value);break;case"rejected":this.rejected(this.value)}},notify:function(t,n){k(function(e){if(t.length)for(var r=0,i=t.length;r<i;++r)t[r](n);e.chained||"rejected"!==e.state||e.uncaught()},this)},uncaught:function(){var t=this.value;t instanceof Error?y("Uncaught",t.stack||t.name+": "+t.message):y("Uncaught Error:",t)}},P.name="Promise",P.prototype={constructor:P,then:function(t,n){var e,r,i=this["<resolver>"],o=new P(function(t,n){e=t,r=n});return i.addCallbacks(j(t)?A(o,e,r,t):e,j(n)?A(o,e,r,n):r),o},"catch":function(t){return this.then(void 0,t)},"finally":t},P.resolve=function(t){return t&&t instanceof P?t:new P(function(n){n(t)})},P.reject=function(t){return new P(function(n,e){e(t)})},P.all=function(t){return new P(function(n,e){if(!v(t))return e(new TypeError("Promise.all expects an array of values or promises"));var r=[],i=t.length;if(i<1)return n(r);var o=i;function s(t){return function(e){r[t]=e,0==--o&&n(r)}}for(var a=0;a<i;a++)P.resolve(t[a]).then(s(a),e)})},P.race=function(t){return new P(function(n,e){if(!v(t))return e(new TypeError("Promise.race expects an array of values or promises"));for(var r=0,i=t.length;r<i;r++)P.resolve(t[r]).then(n,e)})},window.Promise=P}else"function"!=typeof window.Promise.prototype["finally"]&&(window.Promise.prototype["finally"]=t);function g(t,n){this.task=t,this.args=n}function m(t){return"function"==typeof t&&e.test(t)}function b(){for(var t=0;t<u.length;t++)u[t].run();u=[],f=!1}function k(t){var n=function(t,n){n>>>=0;var e=t.length;if(n>=e)return[];for(var r=new Array(e-n);e-- >n;)r[e-n]=t[e];return r}(arguments,1);u[u.length]=new g(t,n),f||(f=!0,r())}function j(t){return"function"==typeof t}function E(){this.callbacks=[],this.errbacks=[],this.state="pending",this.value=null,this.chained=!1}function P(t){if(!(this instanceof P))throw new TypeError(this+"is not a promise");if(!j(t))throw new TypeError("Promise resolver "+t+" is not a function");var n=new E;this["<resolver>"]=n;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(e){n.reject(e)}}function A(t,n,e,r){return function(i){var o;try{o=r(i)}catch(s){return e(s)}if(o===t)return e(new TypeError("Cannot resolve a promise with itself"));n(o)}}}();
//# sourceMappingURL=promise.js.map