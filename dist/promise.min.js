!function(){"use strict";function t(t){return"function"==typeof t}function r(){}function e(t){return"function"==typeof t&&l.test(t)}function n(t,r){this.task=t,this.args=r}function s(){var t=y;y=[];for(var r=0,e=t.length;r<e;r++)t[r].run()}function i(){this._callbacks=[],this._errbacks=[],this._status="pending",this._result=null}function a(r){if(!(this instanceof a))throw new TypeError(this+"is not a promise");if(!t(r))throw new TypeError("Promise resolver "+r+" is not a function");var e=new i;this._resolver=e;try{r(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(n){e.reject(n)}}function o(t,r,e,n){return function(s){var i;try{i=n(s)}catch(a){return e(a)}if(i===t)return e(new TypeError("Cannot resolve a promise with itself"));r(i)}}if(!window.Promise){var u=Object.prototype.toString,c=t(Array.isArray)?Array.isArray:function(t){return"[object Array]"===u.call(t)},l=Function.prototype.toString.call(Function);l=(l=l.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),l=new RegExp("^"+l+"$");var f=window.MutationObserver||window.WebKitMutationObserver,h={support:function(){return e(f)},install:function(t){var r=0,e=new f(t),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=r=++r%2}}},p=window.VBArray,_=window.MessageChannel,v={support:function(){return!e(p)&&e(_)},install:function(t){var r=new _;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}},w={support:function(){return!0},install:function(t){var r=new Image;return r.onerror=t,function(){r.src=""}}};n.prototype.run=function(){var t=this.task,r=this.args;switch(r.length){case 0:return t();case 1:return t(r[0]);case 2:return t(r[0],r[1]);case 3:return t(r[0],r[1],r[2]);default:return t.apply(null,r)}};for(var d,y=[],b=Array.prototype.slice,g=[h,v,w],k=0,j=g.length;k<j;k++)if((d=g[k]).support()){d=d.install(s);break}i.prototype={fulfill:function(t){var r=this._status;"pending"!==r&&"accepted"!==r||(this._result=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._result),this._callbacks=[],this._errbacks=null)},reject:function(t){var r=this._status;"pending"!==r&&"accepted"!==r||(this._result=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._result),this._callbacks=null,this._errbacks=[])},resolve:function(t){"pending"===this._status&&(this._status="accepted",this._value=t,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(r){var e=this,n=!1;if(!r||"object"!=typeof r&&!t(r))return e.fulfill(r);try{var s=r.then;t(s)?s.call(r,function(t){n||(n=!0,e._unwrap(t))},function(t){n||(n=!0,e.reject(t))}):e.fulfill(r)}catch(i){n||e.reject(i)}},_addCallbacks:function(t,r){var e=this._callbacks,n=this._errbacks;switch(e&&e.push(t),n&&n.push(r),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._result);break;case"rejected":this.reject(this._result)}},_notify:function(t,r){t.length&&function(t){var r=b.call(arguments,1);y.push(new n(t,r)),d()}(function(){for(var e=0,n=t.length;e<n;++e)t[e](r)})}},a.prototype={then:function(r,e){var n,s,i=new a(function(t,r){n=t,s=r});return this._resolver._addCallbacks(t(r)?o(i,n,s,r):n,t(e)?o(i,n,s,e):s),i},"catch":function(t){return this.then(undefined,t)}},a.resolve=function(t){return t&&t instanceof a?t:new a(function(r){r(t)})},a.reject=function(t){var e=new a(r),n=e._resolver;return n._result=t,n._status="rejected",e},a.all=function(t){return new a(function(r,e){function n(t){return function(e){i[t]=e,--u||r(i)}}if(!c(t))return e(new TypeError("Promise.all expects an array of values or promises"));var s=0,i=[],o=t.length,u=t.length;if(o<1)return r(i);for(;s<o;s++)a.resolve(t[s]).then(n(s),e)})},a.race=function(t){return new a(function(r,e){if(!c(t))return e(new TypeError("Promise.race expects an array of values or promises"));for(var n=0,s=t.length;n<s;n++)a.resolve(t[n]).then(r,e)})},window.Promise=a}}();
//# sourceMappingURL=promise.js.map