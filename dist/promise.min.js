/**
* @module promise
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript ES6 promise polyfill.
* @see https://nuintun.github.io/promise
*/
!function(){"use strict";function t(t){return"function"==typeof t&&c.test(t)}function n(t,n){this.task=t,this.args=n}function e(){var t=d;d=[];for(var n=0,e=t.length;n<e;n++)t[n].run()}function r(t){return"function"==typeof t}function i(){this._callbacks=[],this._errbacks=[],this._status="pending",this._value=null,this._chained=!1}function a(t){if(!(this instanceof a))throw new TypeError(this+"is not a promise");if(!r(t))throw new TypeError("Promise resolver "+t+" is not a function");var n=new i;this._resolver=n;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(e){n.reject(e)}}function s(t,n,e,r){return function(i){var a;try{a=r(i)}catch(s){return e(s)}if(a===t)return e(new TypeError("Cannot resolve a promise with itself"));n(a)}}if(!window.Promise){var c=Function.prototype.toString.call(Function);c=(c=c.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),c=new RegExp("^"+c+"$");var o=window.MutationObserver||window.WebKitMutationObserver,u={support:function(){return t(o)},install:function(t){var n=0,e=new o(t),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=n=++n%2}}},l=window.VBArray,f=window.MessageChannel,h={support:function(){return!t(l)&&t(f)},install:function(t){var n=new f;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}},p={support:function(){return"onreadystatechange"in document.createElement("script")},install:function(t){return function(){var n=document.createElement("script");n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},document.documentElement.appendChild(n)}}},_={support:function(){return!0},install:function(t){return function(){setTimeout(t,0)}}};n.prototype.run=function(){var t=this.task,n=this.args;switch(n.length){case 0:return t();case 1:return t(n[0]);case 2:return t(n[0],n[1]);case 3:return t(n[0],n[1],n[2]);default:return t.apply(null,n)}};for(var v,d=[],w=Array.prototype.slice,y=[u,h,p,_],g=0,b=y.length;g<b;g++)if((v=y[g]).support()){v=v.install(e);break}var m=Object.prototype.toString,k=r(Array.isArray)?Array.isArray:function(t){return"[object Array]"===m.call(t)},j=window.console,E=j&&j.error?j.error:function(){};i.prototype={fulfill:function(t){var n=this._status;"pending"!==n&&"accepted"!==n||(this._value=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._value),this._callbacks=[],this._errbacks=null)},reject:function(t){var n=this._status;"pending"!==n&&"accepted"!==n||(this._value=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._value),this._callbacks=null,this._errbacks=[])},resolve:function(t){"pending"===this._status&&(this._status="accepted",this._value=t,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(t){var n=this,e=!1;if(!t||"object"!=typeof t&&!r(t))return n.fulfill(t);try{var i=t.then;r(i)?i.call(t,function(t){e||(e=!0,n._unwrap(t))},function(t){e||(e=!0,n.reject(t))}):n.fulfill(t)}catch(a){e||n.reject(a)}},_addCallbacks:function(t,n){var e=this._callbacks,r=this._errbacks;switch(e&&e.push(t),r&&r.push(n),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._value);break;case"rejected":this.reject(this._value)}},_notify:function(t,e){!function(t){var e=w.call(arguments,1);d.push(new n(t,e)),v()}(function(n){if(t.length)for(var r=0,i=t.length;r<i;++r)t[r](e);n._chained||"rejected"!==n._status||n._uncaught()},this)},_uncaught:function(){var t=this._value;t instanceof Error?E("Uncaught",t.stack||t.name+": "+t.message):E("Uncaught Error:",t)}},a.name="Promise",a.prototype={constructor:a,then:function(t,n){var e,i,c=this._resolver;c._chained=!0;var o=new a(function(t,n){e=t,i=n});return c._addCallbacks(r(t)?s(o,e,i,t):e,r(n)?s(o,e,i,n):i),o},"catch":function(t){return this.then(undefined,t)}},a.resolve=function(t){return t&&t instanceof a?t:new a(function(n){n(t)})},a.reject=function(t){return new a(function(n,e){e(t)})},a.all=function(t){return new a(function(n,e){function r(t){return function(e){s[t]=e,--o||n(s)}}if(!k(t))return e(new TypeError("Promise.all expects an array of values or promises"));var i=0,s=[],c=t.length,o=t.length;if(c<1)return n(s);for(;i<c;i++)a.resolve(t[i]).then(r(i),e)})},a.race=function(t){return new a(function(n,e){if(!k(t))return e(new TypeError("Promise.race expects an array of values or promises"));for(var r=0,i=t.length;r<i;r++)a.resolve(t[r]).then(n,e)})},window.Promise=a}}();
//# sourceMappingURL=promise.js.map